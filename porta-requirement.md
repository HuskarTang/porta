# 软件需求规格说明书（SRS）
文档名称：Porta SRS  
版本：0.1  
状态：草案  
维护人：待定  
最后更新：2026-01-15  

---

# 1. 引言
## 1.1 目的
本文档用于定义 Porta 项目的完整软件需求，作为设计、开发、测试与验收的依据。

## 1.2 范围
Porta 是一个基于 LibP2P 的网络应用，通过点对点安全隧道实现远端服务访问与代理，提供桌面 GUI 与 Web 管理界面，支持 EdgeNode 与 CommunityNode 两种节点形态。

## 1.3 术语与缩略语
- **Porta 网络**：部署 Porta 应用后形成的系统集合（节点、服务、隧道连接）。
- **节点（Node）**：Porta 网络中的应用实例，分为 EdgeNode 与 CommunityNode。
- **EdgeNode**：可注册本地服务供他人访问，也可访问其他节点服务。
- **CommunityNode**：提供中转与代理能力，支持服务公告板/服务查询/节点查询/路由查询等。
- **服务（Service）**：节点对外提供的能力描述，包含协议、端口、描述等。
- **隧道（Tunnel）**：节点间基于 LibP2P 的安全连接，用于服务访问或端口映射。

## 1.4 参考资料
- `porta-requirement.md` 原始需求说明
- `attachments/` 目录 UI 原型图

---

# 2. 总体描述
## 2.1 产品视角
Porta 由前端 UI、后台服务与 LibP2P 网络层构成。应用支持 GUI 模式与后台服务模式，复用同一套前端页面。

## 2.2 产品功能概述
- 节点配置与身份管理
- 社区节点管理与连接
- 服务发布、发现、订阅、连接与访问
- 服务映射与安全服务映射
- Omega 代理服务
- 社区侧服务管理与节点管理

## 2.3 用户类型与特征
- **普通用户**：在本地发布或访问远端服务
- **管理员/运营者**：管理社区节点内服务与节点

## 2.4 运行环境
- 桌面应用：Windows/macOS/Linux
- Web 管理：主流现代浏览器内核（WebView/Chrome/Firefox/Safari）

## 2.5 设计与实现约束
- 核心网络能力基于 LibP2P
- 核心业务逻辑使用 Rust
- 前端使用 Vue + TypeScript + ElementPlus
- 所有前端资源必须本地打包，不允许在线资源依赖

## 2.6 假设与依赖
- CommunityNode 具备公网可访问地址（IP 或域名）
- 端口映射与代理在目标平台具备必要权限

---

# 3. 需求规格
## 3.1 功能需求

### 3.1.1 节点配置
**描述**：配置节点名称、密钥文件、监听端口、外部可达地址等。  
**输入**：节点名称、key 文件路径、LibP2P 监听端口、外部地址（可选）。  
**输出**：节点配置保存成功/失败提示。  
**UI 原型**：`attachments/Clipboard_20260115085925.png`

### 3.1.2 社区节点管理（添加/列表）
**描述**：维护社区节点信息列表，通过 Multiaddr/二维码/UUID/PeerID 添加。  
**UI 原型**：`attachments/Clipboard_20260115090708.png`

### 3.1.3 社区节点连接
**描述**：建立与社区节点的 LibP2P 连接，完成注册与服务同步。  
**依赖**：节点配置已完成，社区地址可达。

### 3.1.4 服务定义
**字段**：
- UUID（全局唯一）
- Name（人类可读）
- Protocol（http/https/tcp/udp/omega/ws）
- Port（服务端口）
- Description（描述）
- NodeId（提供服务的节点 ID）
- Others（预留）

### 3.1.5 服务发现
**描述**：从社区节点获取服务列表。  
**UI 原型**：  
`attachments/Clipboard_20260115095239.png`  
`attachments/Clipboard_20260115095214.png`

### 3.1.6 服务订阅
**描述**：对发现的服务执行订阅并记录到服务订阅表。  
**UI 原型**：`attachments/Clipboard_20260115095639.png`

### 3.1.7 服务连接与访问
**描述**：对订阅服务建立隧道并访问。HTTP/HTTPS 服务映射到本地端口后打开浏览器。  
**UI 原型**：  
`attachments/Clipboard_20260115103426.png`  
`attachments/Clipboard_20260115143809.png`

### 3.1.8 服务发布
**描述**：发布本地服务到 Porta 网络，提供下架与删除管理。  
**UI 原型**：  
`attachments/Clipboard_20260115105918.png`  
`attachments/Clipboard_20260115110645.png`

### 3.1.9 社区服务管理
**描述**：社区节点对注册服务进行公告/禁用管理。  
**UI 原型**：`attachments/Clipboard_20260115112207.png`

### 3.1.10 社区节点管理
**描述**：封禁与解封边缘节点。  
**UI 原型**：`attachments/Clipboard_20260115111751.png`

### 3.1.11 隧道建立
**描述**：
1. EdgeNode 与 CommunityNode 直接建立连接  
2. EdgeNode 间以社区节点代理连接并支持 hole punching 升级  
3. 所有连接启用 noise + tls  

### 3.1.12 服务映射
**描述**：远端服务端口映射到本地端口并访问。  
**示意图**：`attachments/Clipboard_20260115114042.png`

### 3.1.13 安全服务映射
**描述**：通过至少两个中间节点代理转发建立安全映射。  
**示意图**：`attachments/Clipboard_20260115135550.png`

### 3.1.14 Omega 代理
**描述**：节点监听本地端口提供 HTTP/HTTPS/SOCK4/SOCK5 代理。  
**默认**：启用，可配置关闭。  
**说明**：代理能力作为服务发布到 Porta 网络。

## 3.2 外部接口需求
### 3.2.1 用户界面
UI 详见 `attachments/` 目录原型图。

### 3.2.2 网络与协议
基于 LibP2P 的服务注册、发现、路由与代理协议。

### 3.2.3 运行模式
支持 GUI 模式与后台服务模式。  
示例：`porta -b -p 8090`

## 3.3 非功能需求
### 3.3.1 性能
- 隧道建立时间 < 3 秒  
- 服务列表加载时间 < 1 秒  
- 支持并发建立多个隧道连接  
- 运行稳定，支持心跳保活与断连重连  

### 3.3.2 可用性
- 操作直观、学习成本低  
- 关键操作需确认提示  
- 错误信息清晰  

### 3.3.3 安全性
- 隧道连接必须加密  
- 本地配置安全存储，敏感信息脱密处理  
- 防止中间人攻击  
- 访问权限控制  

### 3.3.4 兼容性
- 支持主流现代浏览器内核  
- 向后兼容现有 LibP2P 协议版本  
- 配置数据支持导入/导出  

## 3.4 约束与合规
- LibP2P 作为底层网络通信框架  
- Rust 负责核心业务逻辑与隧道实现  
- Vue + TS + ElementPlus 负责界面渲染  
- 资源必须本地化打包  

---

# 4. 运行模式
## 4.1 GUI 应用模式
- 启动完整桌面应用界面  
- 支持系统托盘与全局快捷键  
- 提供原生应用体验  

## 4.2 后台服务模式
- 无图形界面，后台服务运行  
- 提供 HTTP API 接口  
- Web 浏览器访问完整管理界面  
- 支持系统服务部署  

---

# 5. 跨平台要求
- 支持 Windows、macOS、Linux  
- 功能一致  
- 适配不同平台交互习惯  

---

# 6. 部署与发布
- 支持生成单个可执行文件  
- 支持安装包分发  
- 支持系统服务方式安装  
- 配置文件路径符合各平台规范  

---

# 7. 验收标准
## 7.1 功能验收
1. 能建立 LibP2P 安全隧道  
2. HTTP 服务可通过本地端口访问  
3. 代理服务可正确转发流量  
4. 所有界面功能按钮操作正常  
5. 后台模式可 Web 访问完整功能  

## 7.2 兼容性验收
1. Windows 10/11 正常运行  
2. macOS 最新两个版本正常运行  
3. Ubuntu LTS 正常运行  
4. Chrome/Firefox/Safari 最新版显示正常  
